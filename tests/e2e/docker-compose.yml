version: '3.1'
services:
  db:
    image: mysql:5.7
    restart: on-failure
    env_file:
      - ./.env
    volumes:
      - db:/var/lib/mysql
  wordpress-dev:
    env_file:
      - ./.env
    depends_on:
      - db
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - WP_TAG=${WP_VERSION}
    ports:
      - "8000:80"
    restart: on-failure
    volumes:
      - "../../:/var/www/html/wp-content/plugins/klarna-checkout-for-woocommerce"
      - "wordpress:/var/www/html"
  wordpress-cli:
    env_file:
      - ./.env
    depends_on:
      - db
      - wordpress-dev
    build:
      context: ./cli/
    restart: on-failure
    user: xfs
    volumes:
      - "../../:/var/www/html/wp-content/plugins/klarna-checkout-for-woocommerce"
      - "wordpress:/var/www/html"
  phpmyadmin-db:
    image: phpmyadmin/phpmyadmin
    depends_on:
      - db
    restart: always
    ports:
      - "8080:80"
    environment:
      PMA_HOST: db

volumes:
  db:
  wordpress:
