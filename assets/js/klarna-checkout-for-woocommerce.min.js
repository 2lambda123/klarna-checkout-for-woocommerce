jQuery(function(e){if("undefined"==typeof klarna_checkout_for_woocommerce_params)return!1;var o={bodyEl:e("body"),checkoutFormSelector:"form.checkout",orderNotesValue:"",orderNotesSelector:"textarea#order_comments",orderNotesEl:e("textarea#order_comments"),extraFieldsValues:{},extraFieldsSelectorText:'div#kco-extra-fields input[type="text"], div#kco-extra-fields input[type="password"], div#kco-extra-fields textarea',extraFieldsSelectorNonText:'div#kco-extra-fields select, div#kco-extra-fields input[type="radio"], div#kco-extra-fields input[type="checkbox"]',paymentMethodEl:e('input[name="payment_method"]'),paymentMethod:"",selectAnotherSelector:"#klarna-checkout-select-other",documentReady:function(){o.log(klarna_checkout_for_woocommerce_params),o.paymentMethodEl.length>0?o.paymentMethod=o.paymentMethodEl.filter(":checked").val():o.paymentMethod="klarna_checkout_for_woocommerce",o.confirmLoading()},kcoSuspend:function(){window._klarnaCheckout(function(e){e.suspend()})},kcoResume:function(){window._klarnaCheckout(function(e){e.resume()})},confirmLoading:function(){e("#kco-confirm-loading").css("minHeight","300px").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},updateCart:function(){o.kcoSuspend(),e("body").trigger("update_checkout"),e.ajax({type:"POST",url:klarna_checkout_for_woocommerce_params.update_cart_url,data:{checkout:e("form.checkout").serialize(),nonce:klarna_checkout_for_woocommerce_params.update_cart_nonce},dataType:"json",success:function(e){},error:function(e){},complete:function(e){o.kcoResume()}})},updateShipping:function(){o.kcoSuspend(),e("body").trigger("update_checkout");var a={};e('select.shipping_method, input[name^="shipping_method"][type="radio"]:checked, input[name^="shipping_method"][type="hidden"]').each(function(){a[e(this).data("index")]=e(this).val()}),e.ajax({type:"POST",url:klarna_checkout_for_woocommerce_params.update_shipping_url,data:{shipping:a,nonce:klarna_checkout_for_woocommerce_params.update_shipping_nonce},success:function(e){},error:function(e){},complete:function(e){o.kcoResume()}})},updateExtraFields:function(){var a=e(this).attr("name"),t=e(this).val();o.log("value"),o.log(t),o.log("name"),o.log(a),o.log(typeof o.extraFieldsValues),o.log(o.extraFieldsValues),null===o.extraFieldsValues&&""===t||null!==o.extraFieldsValues&&a in o.extraFieldsValues&&t===o.extraFieldsValues||(null===o.extraFieldsValues&&(o.extraFieldsValues={}),o.log("update"),o.extraFieldsValues[a]=t,e.ajax({type:"POST",url:klarna_checkout_for_woocommerce_params.update_extra_fields_url,data:{extra_fields_values:o.extraFieldsValues,nonce:klarna_checkout_for_woocommerce_params.update_extra_fields_nonce},success:function(e){},error:function(e){},complete:function(e){o.log("complete",e)}}))},updateOrderNotes:function(){o.orderNotesEl.val()!==o.orderNotesValue&&(o.orderNotesValue=o.orderNotesEl.val(),e.ajax({type:"POST",url:klarna_checkout_for_woocommerce_params.update_order_notes_url,data:{order_notes:o.orderNotesValue,nonce:klarna_checkout_for_woocommerce_params.update_order_notes_nonce},success:function(e){},error:function(e){},complete:function(e){o.log("complete",e)}}))},changeFromKco:function(a){a.preventDefault(),e(o.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({type:"POST",dataType:"json",data:{kco:!1,nonce:klarna_checkout_for_woocommerce_params.change_payment_method_nonce},url:klarna_checkout_for_woocommerce_params.change_payment_method_url,success:function(e){},error:function(e){},complete:function(e){o.log(e.responseJSON),window.location.href=e.responseJSON.data.redirect}})},maybeChangeToKco:function(){o.log(e(this).val()),"klarna_checkout_for_woocommerce"===e(this).val()&&(e(".woocommerce-info").remove(),e(o.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({type:"POST",data:{kco:!0,nonce:klarna_checkout_for_woocommerce_params.change_payment_method_nonce},dataType:"json",url:klarna_checkout_for_woocommerce_params.change_payment_method_url,success:function(e){},error:function(e){},complete:function(e){o.log(e.responseJSON),window.location.href=e.responseJSON.data.redirect}}))},log:function(e){console.log(klarna_checkout_for_woocommerce_params.logging),klarna_checkout_for_woocommerce_params.logging&&console.log(e)},init:function(){e(document).ready(o.documentReady),o.bodyEl.on("change","input.qty",o.updateCart),o.bodyEl.on("change","input.shipping_method",o.updateShipping),o.bodyEl.on("blur",o.extraFieldsSelectorText,o.updateExtraFields),o.bodyEl.on("change",o.extraFieldsSelectorNonText,o.updateExtraFields),o.bodyEl.on("change",'input[name="payment_method"]',o.maybeChangeToKco),o.bodyEl.on("click",o.selectAnotherSelector,o.changeFromKco),"function"==typeof window._klarnaCheckout&&window._klarnaCheckout(function(a){a.on({change:function(a){o.log("change",a),e("table.woocommerce-checkout-review-order-table").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),o.kcoSuspend(),e.ajax({url:klarna_checkout_for_woocommerce_params.iframe_change_url,type:"POST",dataType:"json",data:{data:a,nonce:klarna_checkout_for_woocommerce_params.iframe_change_nonce},success:function(a){o.log(a),e("table.woocommerce-checkout-review-order-table").replaceWith(a.data.html)},error:function(e){o.log(e)},complete:function(){e("table.woocommerce-checkout-review-order-table").unblock(),o.kcoResume()}})},shipping_address_change:function(e){o.log("shipping_address_change",e)},order_total_change:function(e){o.log("order_total_change",e)},shipping_option_change:function(e){o.log("shipping_option_change",e)},can_not_complete_order:function(e){o.log("can_not_complete_order",e)}})})}};o.init()});